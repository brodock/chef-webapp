# apache2 <%= @app %> rails application vhost
#
# Generated by Chef for <%= node[:fqdn] %>
# Local modifications will be overwritten.
#
<% if @non_ssl_server && @www_redirect && !@host_name.nil? -%>
<VirtualHost *:80>
  ServerName        www.<%= @host_name %>
<% @host_aliases.each do |a| -%>
  ServerAlias       www.<%= a %>
<% end -%>

  RewriteEngine     On
  RewriteCond       %{HTTP_HOST} ^www.<%= @host_name %>$ [NC]
  RewriteRule       ^/(.*)$ http://<%= @host_name %>/$1 [R=301,L]
</VirtualHost>

<% end -%>
<% if @non_ssl_server -%>
<VirtualHost *:80>
<% unless @host_name.nil? -%>
  ServerName        <%= @host_name %>
<% end -%>
<% @host_aliases.each do |a| -%>
  ServerAlias       <%= a %>
<% end -%>

  DocumentRoot      <%= @docroot %>
  <Directory <%= @docroot %>>
    Options FollowSymlinks
    Options -MultiViews
    Allow from all
  </Directory>
</VirtualHost>
<% end -%>
